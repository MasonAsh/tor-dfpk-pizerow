sudo: required
services:
- docker
language: bash
before_script:
- openssl aes-256-cbc -K $encrypted_2dcd83ba0da9_key -iv $encrypted_2dcd83ba0da9_iv -in .dm.enc -out .dm -d
- sudo apt-get -qq update
- curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -
- sudo apt-get install -y nodejs
- sudo npm install -g @mumbacloud/dmport
- eval $(dmport --import "$(cat .dm)")
- rm -f .dm
script:
- export COMPOSE_PROJECT_NAME=torvpinpizerow
- make
- cp tor-vpin-pizerow.img tor-vpin-pizerow_${TRAVIS_TAG}.img
after_success:
- docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
- docker push sofwerx/tor-vpin-pizerow:${TRAVIS_TAG}
branches:
  only:
  - master
  - "/^v\\d.*$/"
deploy:
  provider: releases
  skip_cleanup: true
  api_key: "${GITHUB_TOKEN}"
  file:
  - tor-vpin-pizerow_${TRAVIS_TAG}.img
  on:
    tags: true
    repo: "${TRAVIS_REPO_SLUG}"
notifications:
  slack:
    rooms:
      secure: cUxeeGX3qVhnX+F0q08QYXWrwAZleXd0AJuz3paFRCKpCPjqyw1K5MIl3qnrBxvjCet4Yf/8OrzaNZCTwSvSwdZtMybJm9x3zEJ3FxqohnVbnMKm/Mm7a1ULVLutWF89LDiOBaL+Y3j35SOCcD3NAm6g39MiF0tM08TYqqr3ieLjjgqd0pcwLE8bSBHuGwxmwXN6kyUNCOv2Z5xGwQCOFjlu1B+WqbqfsYthB/vhBQarjOO2HIO79uq1mQs8CxHKvzajeF0m0vHSZfg3u60bnd5IKDT5n9TeVNmkBkxP37gYNjWLNE82/XSDkl5Q4OBqGGR/FgqvThcZ8cOnkKHVrvBNt8CJahe2cHnWIq0jclSOG6jzNz2ISwp9MzAmV8IZM1T7Eiv8xzoHwwOfnBuetnwCjBuPLUbu3doibYdl4kJLQYBb0t4qZTZ7RkbQLkEu4gtxEf9lGLRyGreeWPbSXbhtA9UemZT3Euro31nboNm0ShnI7zSmvrK+V2ajhwhjj2+sMNDhXHwRC6Ms9iA85CHTBTKAkR8DWNjOjo+RkoP1pJMlGznBZ5vdtecJPdtgdgAsRioW4Zc2Wo1P1w48Gq2uRbxyXwGJLYL6r/tb/B+QUuh43KMin+BA57QzhPjZXfXjKJEr5H2o50gNyYSe6v4MRhAQsSLw/dOygz/nVDM=
